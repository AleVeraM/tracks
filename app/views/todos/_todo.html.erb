<% cache [todo, current_user.date.strftime("%Y%m%d"), @source_view, current_user.prefs.verbose_action_descriptors] do -%>
  <div id="<%= dom_id(todo) %>" class="todo-item container-fluid" 
       data-info="<%= render partial: "todos/todo_info", locals: {todo: todo} %>">
    <div class="row">
      <div class="col-md-8">
        <span class="todo-item-icons">
          <i class="fa <%= todo.completed? ? "fa-check-square-o" : "fa-square-o" %>"></i>
          <i class="fa <%= todo.starred?   ? "fa-star" : "fa-star-o"%>"></i>
        </span>
        <span class="todo-item-description-container">
          <span class="todo-description <%= "tracks-todo-overdue" if todo.overdue?%>"><%= todo.description %></span>
          <span class="todo-description-icons">
            <%= content_tag(:i, {class: "fa fa-refresh"}){} if todo.from_recurring_todo? -%>
            <%= deferred_due_date(todo) -%>
            <%= content_tag(:i, {class: "fa fa-sitemap"}){} if todo.has_pending_successors -%>
            <%= content_tag(:i, {class: "fa fa-book", "data-note-id" => dom_id(todo, 'notes')}){} unless todo.notes.blank? %>
          </span>
        </span>
        <span class="todo-item-detail hide"><br/>
          <p class="todo-project-and-context"><small>
            project: <span class="todo-project-name"><%= todo.project.name.blank? ? "none" : link_to(todo.project.name, todo.project) %></span><br/>
            context: <span class="todo-context-name"><%= todo.context.name.blank? ? "none" : link_to(todo.context.name, todo.context) %></span>
          </small></p>
        </span>
      </div>
      <div class="col-md-4 pull-right hidden-phone tracks-todo-badges">
        <%= date_span(todo) -%>
        <%= tag_list(todo) %>
      </div>
    </div>
    <div class="row">
      <div id="<%=dom_id(todo, 'notes')%>" class="todo-notes hide">
        <%= todo_notes(todo) %>
      </div>
    </div>
  </div>
<% end -%>

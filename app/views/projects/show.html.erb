<% 
  deferred_pending_options = {:append_descriptor => nil, :parent_container_type => 'project'}
  done_todo_options = {
    :append_descriptor => t('projects.last_completed_in_project', :number=>prefs.show_number_completed), 
    :suppress_project => true, 
    :parent_container_type => 'project'
  }
  if @not_done_todos.count == 0
    # force project view so one empty container will be shown with an empty message
    @group_view_by = 'project'
  end
-%>
<div id="display_box">
  <%= project_next_prev %>

  <% cache @project do %>
    <%= render :partial => "project_settings_container", :locals => {:project => @project} %>
  <% end %>

  <% cache ["not_done_project", @not_done_todos.empty?] do -%>
    <%= render partial: "todos/empty_message_container", locals: {:show => @not_done_todos.empty?, :container_name => "not_done"} %>
  <% end -%>

  <%= show_grouped_todos({:collapsible => false, :show_empty_containers => false, :parent_container_type => 'project' }) %>

  <% cache [@project, "deferred_pending"] do -%>
    <%= show_deferred_pending_todos(@deferred_todos, @pending_todos, deferred_pending_options) %>
  <% end -%>

  <% # use the first completed todo (which is the last one to be completed) as cache invariant
    cache [@project, @done.first, "project_completed"] do -%>
      <%= show_done_todos(@done, done_todo_options) unless @done.nil? %>
  <% end -%>

  <%# TODO: new note impl -%>
  <div class="container">
    <div id="notes">
      <h2><%= t('projects.notes') %></h2>
    </div>
  </div>

</div>